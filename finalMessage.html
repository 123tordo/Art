<script>
    document.addEventListener("DOMContentLoaded", function () {
        const videoElement = document.getElementById('video');

        // Check if getUserMedia is available
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (stream) {
                    videoElement.srcObject = stream;

                    // Initialize QuaggaJS
                    Quagga.init({
                        inputStream: {
                            name: "Live",
                            type: "LiveStream",
                            target: videoElement
                        },
                        decoder: {
                            readers: ["code_128_reader"]
                        }
                    }, function (err) {
                        if (err) {
                            console.error('Error initializing Quagga:', err);
                            return;
                        }
                        Quagga.start();
                    });

                    // Attach click event directly to the video element to start scanning
                    videoElement.addEventListener('click', function () {
                        Quagga.start();
                    });

                    Quagga.onDetected(function (result) {
                        alert('Scanned: ' + result.codeResult.code);
                        // You can navigate to the destination site here
                        // window.location.href = result.codeResult.code;
                    });
                })
                .catch(function (error) {
                    console.error('Error accessing camera:', error);
                });
        } else {
            console.error('getUserMedia is not supported in this browser');
        }
    });
</script>
